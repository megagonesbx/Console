"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[291],{8291:(ue,Z,s)=>{s.r(Z),s.d(Z,{UsersModule:()=>ce});var U=s(4521),N=s(655),l=s(3075),m=s(8966),u=s(1937),T=s(7579),c=s(2722),e=s(5e3),f=s(4557),p=s(9808),h=s(7322),C=s(7531),b=s(4102),y=s(508),g=s(7423);function w(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function D(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function J(o,n){if(1&o&&(e.TgZ(0,"mat-option",12),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.description)}}function S(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function k(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido y debe ser un correo electr\xf3nico v\xe1lido. "),e.qZA())}function I(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function Q(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"h2",1),e._uU(2,"Datos de usuario"),e.qZA(),e.TgZ(3,"form",2),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().createUser()}),e.TgZ(4,"mat-form-field")(5,"input",3),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(6,w,2,0,"mat-error",0),e.qZA(),e.TgZ(7,"mat-form-field")(8,"input",4),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(9,D,2,0,"mat-error",0),e.qZA(),e.TgZ(10,"mat-form-field")(11,"mat-select",5),e.YNc(12,J,2,2,"mat-option",6),e.qZA(),e.YNc(13,S,2,0,"mat-error",0),e.qZA(),e.TgZ(14,"mat-form-field")(15,"input",7),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(16,k,2,0,"mat-error",0),e.qZA(),e.TgZ(17,"mat-form-field"),e._UZ(18,"input",8),e.YNc(19,I,2,0,"mat-error",0),e.qZA(),e.TgZ(20,"div",9)(21,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e._uU(22,"Cancelar"),e.qZA(),e.TgZ(23,"button",11),e._uU(24,"Guardar"),e.qZA()()(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("formGroup",t.userForm),e.xp6(3),e.Q6J("ngIf",t.userForm.get("firstName").invalid&&t.userForm.get("firstName").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("lastName").invalid&&t.userForm.get("lastName").touched),e.xp6(3),e.Q6J("ngForOf",t.roles),e.xp6(1),e.Q6J("ngIf",t.userForm.get("role").invalid&&t.userForm.get("role").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("email").invalid&&t.userForm.get("email").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("password").invalid&&t.userForm.get("password").touched),e.xp6(4),e.Q6J("color","primary")("disabled",t.userForm.invalid||t.userForm.pristine)}}function q(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function E(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function Y(o,n){if(1&o&&(e.TgZ(0,"mat-option",12),e._uU(1),e.qZA()),2&o){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.description)}}function R(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function B(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido y debe ser un correo electr\xf3nico v\xe1lido. "),e.qZA())}function M(o,n){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," Este campo es requerido. "),e.qZA())}function O(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"h2",1),e._uU(2,"Actualizar usuario"),e.qZA(),e.TgZ(3,"form",2),e.NdJ("ngSubmit",function(){return e.CHM(t),e.oxw().updateUser()}),e.TgZ(4,"mat-form-field")(5,"input",3),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(6,q,2,0,"mat-error",0),e.qZA(),e.TgZ(7,"mat-form-field")(8,"input",4),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(9,E,2,0,"mat-error",0),e.qZA(),e.TgZ(10,"mat-form-field")(11,"mat-select",5),e.YNc(12,Y,2,2,"mat-option",6),e.qZA(),e.YNc(13,R,2,0,"mat-error",0),e.qZA(),e.TgZ(14,"mat-form-field")(15,"input",7),e.NdJ("keydown",function(i){return e.CHM(t),e.oxw().onKeyDown(i)}),e.qZA(),e.YNc(16,B,2,0,"mat-error",0),e.qZA(),e.TgZ(17,"mat-form-field"),e._UZ(18,"input",8),e.YNc(19,M,2,0,"mat-error",0),e.qZA(),e.TgZ(20,"div",9)(21,"button",10),e.NdJ("click",function(){return e.CHM(t),e.oxw().onCancel()}),e._uU(22,"Cancelar"),e.qZA(),e.TgZ(23,"button",11),e._uU(24,"Actualizar"),e.qZA()()(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("formGroup",t.userForm),e.xp6(3),e.Q6J("ngIf",t.userForm.get("firstName").invalid&&t.userForm.get("firstName").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("lastName").invalid&&t.userForm.get("lastName").touched),e.xp6(3),e.Q6J("ngForOf",t.roles),e.xp6(1),e.Q6J("ngIf",t.userForm.get("role").invalid&&t.userForm.get("role").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("email").invalid&&t.userForm.get("email").touched),e.xp6(3),e.Q6J("ngIf",t.userForm.get("password").invalid&&t.userForm.get("password").touched),e.xp6(4),e.Q6J("color","primary")("disabled",t.userForm.invalid||t.userForm.pristine)}}let A=(()=>{class o{constructor(t,r,i,a,d){this.data=t,this._formBuilder=r,this.dialogRef=i,this._userService=a,this._snackBarService=d,this.newUser=!0,this.roles=[],this._unsubscribeAll=new T.x,this.roles=u.uJ}ngOnInit(){var t,r;this.initForm(),(null===(t=null==this?void 0:this.data)||void 0===t?void 0:t.user)&&(this.newUser=!1,this.setForm(null===(r=null==this?void 0:this.data)||void 0===r?void 0:r.user))}initForm(){this.newUser=!0,this.userForm=this._formBuilder.group({id:[],firstName:["",[l.kI.required]],lastName:["",[l.kI.required]],role:["",[l.kI.required]],email:["",[l.kI.required,l.kI.email]],password:["",[l.kI.required]]})}setForm(t){this.userForm.patchValue({id:t.id,firstName:(0,u.cF)(t.DisplayName)[0],lastName:(0,u.cF)(t.DisplayName)[1],role:t.Role,email:t.Email,password:""}),this.userForm.controls.password.clearValidators()}createUser(){if(this.userForm.invalid)return Object.values(this.userForm.controls).forEach(t=>t.markAsTouched());this._userService.createUser(this.userForm.value).pipe((0,c.R)(this._unsubscribeAll)).subscribe(t=>200==t?(this.onCancel(),this._snackBarService.open("El usuario se ha creado exit\xf3samente")):(this.onCancel(),this._snackBarService.open("Ha ocurrido un error al crear el usuario")))}updateUser(){if(this.userForm.invalid)return Object.values(this.userForm.controls).forEach(a=>a.markAsTouched());const t=this.userForm.value,{password:r}=t,i=(0,N._T)(t,["password"]);r&&(i.password=r),this._userService.updateUser(i).pipe((0,c.R)(this._unsubscribeAll)).subscribe(a=>402==a?(this.onCancel(),this._snackBarService.open("No te puedes actualizar a ti mismo.")):200==a?(this.onCancel(),this._snackBarService.open("Se ha actualizado el usuario.")):(this.onCancel(),this._snackBarService.open("Ha ocurrido un error al actualizar el usuario")))}onKeyDown(t){"Space"===t.code&&t.preventDefault()}onCancel(){this.dialogRef.close()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.WI),e.Y36(l.qu),e.Y36(m.so),e.Y36(f.K),e.Y36(u.cw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-dialog"]],decls:2,vars:2,consts:[[4,"ngIf"],["mat-dialog-title",""],["name","userForm",3,"formGroup","ngSubmit"],["matInput","","placeholder","Nombre","formControlName","firstName",3,"keydown"],["matInput","","placeholder","Apellido","formControlName","lastName",3,"keydown"],["placeholder","Rol","formControlName","role"],[3,"value",4,"ngFor","ngForOf"],["matInput","","placeholder","Email","formControlName","email",3,"keydown"],["matInput","","type","password","placeholder","Contrase\xf1a","formControlName","password"],["mat-dialog-actions",""],["mat-button","","type","button",3,"click"],["mat-flat-button","","type","submit",3,"color","disabled"],[3,"value"]],template:function(t,r){1&t&&(e.YNc(0,Q,25,9,"ng-container",0),e.YNc(1,O,25,9,"ng-container",0)),2&t&&(e.Q6J("ngIf",r.newUser),e.xp6(1),e.Q6J("ngIf",!r.newUser))},directives:[p.O5,m.uh,l._Y,l.JL,l.sg,h.KE,C.Nt,l.Fj,l.JJ,l.u,h.TO,b.gD,p.sg,y.ey,m.H8,g.lW],styles:[".mat-form-field[_ngcontent-%COMP%]{display:grid!important;width:100%;margin-bottom:10px}"]}),o})();var x=s(5245),H=s(3844),z=s(6451),L=s(3900),j=s(4004),v=s(6087),_=s(4847),K=s(1683),$=s(3037),F=s(7238);function G(o,n){1&o&&e._UZ(0,"mat-icon",21),2&o&&e.Q6J("matTooltip","Pendiente")}function W(o,n){1&o&&e._UZ(0,"mat-icon",22),2&o&&e.Q6J("matTooltip","Solvente")}function P(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",8)(2,"div",9)(3,"div",10)(4,"div",11),e._uU(5," NO THUMB "),e.qZA()()(),e.TgZ(6,"div",12),e._uU(7),e.qZA(),e.TgZ(8,"div",12),e._uU(9),e.qZA(),e.TgZ(10,"div",12),e._uU(11),e.qZA(),e.TgZ(12,"div",12),e.YNc(13,G,1,1,"mat-icon",13),e.YNc(14,W,1,1,"mat-icon",14),e.qZA(),e.TgZ(15,"div")(16,"button",15),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).openDialog(a)}),e._UZ(17,"mat-icon",16),e.qZA(),e.TgZ(18,"button",17),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).sendNotifiation(a.Email)}),e._UZ(19,"mat-icon",18),e.qZA(),e.TgZ(20,"button",19),e.NdJ("click",function(){const a=e.CHM(t).$implicit;return e.oxw(2).deleteUser(a.id)}),e._UZ(21,"mat-icon",20),e.qZA()()(),e.BQk()}if(2&o){const t=n.$implicit,r=e.oxw(2);e.xp6(7),e.hij(" ",t.DisplayName," "),e.xp6(2),e.hij(" ",t.Email," "),e.xp6(2),e.hij(" ",r.translateRole(t.Role)," "),e.xp6(2),e.Q6J("ngIf",!t.IsSolvent),e.xp6(1),e.Q6J("ngIf",t.IsSolvent),e.xp6(2),e.Q6J("matTooltip","Editar usuario"),e.xp6(2),e.Q6J("disabled",null==t?null:t.IsSolvent)("matTooltip","Enviar recordatorio de pago"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:bell"),e.xp6(1),e.Q6J("matTooltip","Eliminar usuario")}}function V(o,n){if(1&o&&(e.ynx(0),e.YNc(1,P,22,10,"ng-container",7),e.BQk()),2&o){const t=n.ngIf,r=e.oxw();e.xp6(1),e.Q6J("ngForOf",t)("ngForTrackBy",r.trackByFn)}}const X=function(o){return{"pointer-events-none":o}};let ee=(()=>{class o{constructor(t,r,i,a,d,me){this._userService=t,this._changeDetectorRef=r,this.dialog=i,this._fuseConfirmationService=a,this._snackBarService=d,this._notification=me,this._unsubscribeAll=new T.x,this.users=[],this.flashMessage=null,this.diameter=100,this.pageSize=10,this.page=1,this.count=0,this.pages=0,this.pageSizeOptions=[10,15,25]}ngOnInit(){this.getUsers(),this.onListenDialog()}getUsers(){this.loading=!0,this._userService.getUsers({roleId:0,page:1,pageSize:this.pageSize}).pipe((0,c.R)(this._unsubscribeAll)).subscribe(t=>{this.users$=this._userService.users$,this.users=t.users,this.page=t.page,this.count=t.total,this.pages=t.pages,this.loading=!1,this._changeDetectorRef.markForCheck()})}openDialog(t){this.dialog.open(A,{width:"500px",data:{user:t}}).afterClosed().pipe((0,c.R)(this._unsubscribeAll)).subscribe(i=>{this.getUsers()})}onListenDialog(){this._userService.onFoo.pipe((0,c.R)(this._unsubscribeAll)).subscribe(t=>{this.getUsers()})}deleteUser(t){this._fuseConfirmationService.open({title:"Eliminar usuario",message:"\xbfEst\xe1 seguro de eliminar el usuario?",actions:{confirm:{label:"Eliminar"},cancel:{label:"Cancelar"}}}).afterClosed().pipe((0,c.R)(this._unsubscribeAll)).subscribe(i=>{"confirmed"===i&&this._userService.deleteUser(t).pipe((0,c.R)(this._unsubscribeAll)).subscribe(a=>201==a?(this.getUsers(),this._snackBarService.open("El usuario se ha eliminado.")):this._snackBarService.open(402==a?"No te puedes eliminar a ti mismo.":"Ha ocurrido en error al eliminar el usuario."))})}sendNotifiation(t){this._notification.sendNotification({email:t}).pipe((0,c.R)(this._unsubscribeAll)).subscribe(r=>this._snackBarService.open(200==r?"Se le ha enviado un recordatorio de pago al vecino.":"Ha ocurrido un error al enviar el recordatorio al vecino."))}translateRole(t){return(0,u.BA)(t)}translateStatus(t){return t?"Solvente":"Pendiente"}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"DisplayName",start:"asc",disableClear:!0}),this._changeDetectorRef.markForCheck(),(0,z.T)(this._sort.sortChange,this._paginator.page).pipe((0,L.w)(()=>(this.loading=!0,this.pageSize=this._paginator.pageSize,this._userService.getUsers({roleId:0,page:this._paginator.pageIndex+1,pageSize:this._paginator.pageSize}))),(0,j.U)(()=>this.loading=!1)).pipe((0,c.R)(this._unsubscribeAll)).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(1),this._unsubscribeAll.complete()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(f.K),e.Y36(e.sBO),e.Y36(m.uw),e.Y36(K.R),e.Y36(u.cw),e.Y36($.T))},o.\u0275cmp=e.Xpm({type:o,selectors:[["user-list"]],viewQuery:function(t,r){if(1&t&&(e.Gf(v.NW,5),e.Gf(_.YE,5)),2&t){let i;e.iGM(i=e.CRH())&&(r._paginator=i.first),e.iGM(i=e.CRH())&&(r._sort=i.first)}},decls:17,vars:9,consts:[[1,"grid"],["matSort","","matSortDisableClear","",1,"inventory-grid","z-10","sticky","top-0","grid","gap-4","py-4","px-6","md:px-8","shadow","text-md","font-semibold","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"hidden","sm:block"],[3,"mat-sort-header"],[1,"hidden","lg:block"],[4,"ngIf"],[1,"sm:absolute","sm:inset-x-0","sm:bottom-0","border-b","sm:border-t","sm:border-b-0","z-10","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageSizeOptions"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"inventory-grid","grid","items-center","gap-4","py-3","px-6","md:px-8","border-b"],[1,"flex","items-center"],[1,"relative","flex","flex-0","items-center","justify-center","w-12","h-12","mr-6","rounded","overflow-hidden","border"],[1,"flex","items-center","justify-center","w-full","h-full","text-xs","font-semibold","leading-none","text-center","uppercase"],[1,"truncate"],["style","color: red","svgIcon","heroicons_outline:x-circle",3,"matTooltip",4,"ngIf"],["style","color: green","svgIcon","heroicons_outline:check-circle",3,"matTooltip",4,"ngIf"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6",3,"matTooltip","click"],["svgIcon","heroicons_outline:pencil-alt"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"disabled","matTooltip","click"],[3,"svgIcon"],["mat-stroked-button","",1,"min-w-10","min-h-7","h-7","px-2","leading-6","ml-2",3,"matTooltip","click"],["svgIcon","heroicons_outline:user-remove"],["svgIcon","heroicons_outline:x-circle",2,"color","red",3,"matTooltip"],["svgIcon","heroicons_outline:check-circle",2,"color","green",3,"matTooltip"]],template:function(t,r){1&t&&(e.ynx(0),e.TgZ(1,"div",0)(2,"div",1),e._UZ(3,"div",2),e.TgZ(4,"div",3),e._uU(5,"Nombre"),e.qZA(),e.TgZ(6,"div",2),e._uU(7,"Email"),e.qZA(),e.TgZ(8,"div",4),e._uU(9,"Rol"),e.qZA(),e.TgZ(10,"div",2),e._uU(11,"Estado"),e.qZA(),e.TgZ(12,"div",2),e._uU(13,"Opciones"),e.qZA()(),e.YNc(14,V,2,2,"ng-container",5),e.ALo(15,"async"),e.qZA(),e._UZ(16,"mat-paginator",6),e.BQk()),2&t&&(e.xp6(4),e.Q6J("mat-sort-header","name"),e.xp6(10),e.Q6J("ngIf",e.lcZ(15,5,r.users$)),e.xp6(2),e.Q6J("ngClass",e.VKq(7,X,r.loading))("length",r.count)("pageSizeOptions",r.pageSizeOptions))},directives:[_.YE,_.nU,p.O5,p.sg,x.Hw,F.gM,g.lW,v.NW,p.mk],pipes:[p.Ov],styles:[".inventory-grid{grid-template-columns:48px auto 40px}@media (min-width: 600px){.inventory-grid{grid-template-columns:48px 295px 236px 103px 103px 72px}}@media (min-width: 960px){.inventory-grid{grid-template-columns:48px 112px auto 112px 112px 72px}}@media (min-width: 1280px){.inventory-grid{grid-template-columns:48px 349px auto 112px 112px 180px}}\n"],encapsulation:2,data:{animation:H.L},changeDetection:0}),o})();const te=[{path:"",component:(()=>{class o{constructor(t,r){this.dialog=t,this._userService=r}ngOnInit(){}openDialog(){this.dialog.open(A,{width:"500px"}).afterClosed().subscribe(r=>this._userService.foo())}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(m.uw),e.Y36(f.K))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-users"]],decls:12,vars:2,consts:[[1,"sm:absolute","sm:inset-0","flex","flex-col","flex-auto","min-w-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","sm:flex-row","flex-0","sm:items-center","sm:justify-between","py-8","px-6","md:px-8","border-b"],[1,"text-4xl","font-extrabold","tracking-tight"],[1,"flex","flex-shrink-0","items-center","mt-6","sm:mt-0","sm:ml-4"],["mat-flat-button","",1,"ml-4",3,"color","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","sm:mb-18","overflow-hidden","sm:overflow-y-auto"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3,"Usuarios"),e.qZA(),e.TgZ(4,"div",3)(5,"button",4),e.NdJ("click",function(){return r.openDialog()}),e._UZ(6,"mat-icon",5),e.TgZ(7,"span",6),e._uU(8,"Agregar"),e.qZA()()()(),e.TgZ(9,"div",7)(10,"div",8),e._UZ(11,"user-list"),e.qZA()()()),2&t&&(e.xp6(5),e.Q6J("color","primary"),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:plus"))},directives:[g.lW,x.Hw,ee],styles:[""]}),o})()}];let oe=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[[U.Bz.forChild(te)],U.Bz]}),o})();var re=s(7446),ne=s(2181),ie=s(5899),se=s(2368),ae=s(459),le=s(4466);let ce=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({providers:[u.cw],imports:[[le.m,oe,g.ot,re.p9,h.lN,x.Ps,C.c,ne.Tx,v.TU,ie.Cv,y.si,_.JX,b.LD,se.rP,F.AV,m.Is,ae.F]]}),o})()}}]);